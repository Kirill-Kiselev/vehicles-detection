# Vehicles detection

## Запуск проекта:
1. Склонировать проект из GitHub в локальный репозиторий.
2. Перейти в папку с проектом 
3. Выбрать python-интерпретатор (при написания использовался `python 3.9`)
4. Создать виртуальное окружение, выполнив в командной строке `python3 -m venv venv`
5. Активировать виртуальное окружение `source venv/bin/activate`
6. Выполнить установку необходимых библиотек `pip install -r requirements.txt`
7. В файле `run_main.sh` заменить пути до папки с видео, до папки куда будут сохранены тестовые временные интервалы и до .json-файлов, в которых хранятся полигоны, временные интервалы. 
8. Если необходимо выполнить расчет метрик на скрытом тестовом датасете, то в `run_main.sh` параметр `-m` должен быть `calc`. 
9. Если необходимо сохранить временные интервалы на скрытом тестовом датасете, то в `run_main.sh` параметр `-m` должен быть любой, например `save`. 
10. После изменения файла `run_main.sh`, убедитесь, что у него есть права на выполнение: `chmod +x run_main.sh`.
11. Запустить файл `run_main.sh` командой `./run_main.sh`

## Формализация задачи
Бизнес-задачу можно формализовать следующим образом - поскольку нам известен полигон, 
на котором необходимо определить наличие движущихся средств, то нам необходимо детектировать движущие средства в кадре и оценивать их пересечение с заданным полигоном.

В том случае, если в кадре, bounding box движущегося средства пересекается с заданным 
полигоном значит необходимо присвоить кадру метку True, иначе метку False.

Следовательно, мы можем решить эту задачу как задачу бинарной классификации в которой
тестовыми данными будут являться последовательности кадров видео с метками True или False.

Нашей задачей будет являться расстановка таких меток с помощью модели машинного обучения.
Поэтому в качестве метрик будут использованы стандартные метрики для задач бинарной классификации.

## Метрики
1. Матрица ошибок (Confusion Matrix):
   - True Positive (TP): Количество верно предсказанных положительных классов.
   - True Negative (TN): Количество верно предсказанных отрицательных классов.
   - False Positive (FP): Количество ошибочно предсказанных положительных классов.
   - False Negative (FN): Количество ошибочно предсказанных отрицательных классов.

2. Точность (Precision):
   - Показывает, какая доля положительных предсказаний действительно верна.
   - Формула: Precision = TP / (TP + FP)

3. Полнота (Recall или Sensitivity):
   - Показывает, какая доля истинных положительных экземпляров была обнаружена моделью.
   - Формула: Recall = TP / (TP + FN)

4. Точность (Accuracy):
   - Показывает долю правильных предсказаний модели относительно общего числа предсказаний.
   - Формула: Accuracy = Количество правильных предсказаний / Общее количество предсказаний

Выбор этих метрик обусловлен тем что нам может попасться тестовый сэмпл, на котором на
полигон не заедет ни одно движущееся средство. Следовательно, весь ряд тестовых значений 
будет False. Таким образом, если модель корректно присвоит всем кадрам метки False
Precision и Recall будут равны нулю. В таком случае нам стоит ориентироваться на 
метрику матрицы ошибок и Accuracy.

Результаты вычисления метрик находятся в файле `CALCULATED_METRICS.md`

## Эвристики
В качестве эвристики для решения этой задачи была выбрана фиксация простого пересечения 
в пространстве координат bounding box детектируемого движущегося средства и интересующего
нас полигона.

### Неточности
- Поскольку полигон имеет неправильную формы то зачастую возникают ложные детекции bounding box которые пересекаются с полигоном, несмотря на то, что транспортное средство стоит ровно по кромке этого полигона и не заезжает на него.
- Также может возникнуть случай, что транспортное средство будет стоять ближе к камере. Из-за чего возникнет ложный эффект пересечения.

Для того чтобы нивелировать неточности эвристики можно использовать иные пути определения
меток. Например, задание порога по площади пересечения, при котором пересечение bounding box 
с полигоном не будут давать положительную метку. Или же использовать какой-то иной подход.
Но для этого требуется более детальное исследование.

